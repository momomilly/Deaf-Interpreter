<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Camera Streaming Recorder</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,900" rel="stylesheet">
        <link rel="stylesheet" href="fonts/icomoon/style.css">
    
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/jquery-ui.css">
        <link rel="stylesheet" href="css/owl.carousel.min.css">
        <link rel="stylesheet" href="css/owl.theme.default.min.css">
        <link rel="stylesheet" href="css/owl.theme.default.min.css">
        <link rel="stylesheet" href="css/jquery.fancybox.min.css">
        <link rel="stylesheet" href="css/bootstrap-datepicker.css">
        <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
        <link rel="stylesheet" href="css/aos.css">
        <link rel="stylesheet" href="css/style.css">
        
      </head>
    <body data-spy="scroll" data-target=".site-navbar-target" data-offset="300">
        <header class="site-navbar py-4 js-sticky-header site-navbar-target" role="banner">

            <div class="container">
              <div class="row align-items-center">
                
                <div class="col-6 col-xl-2">
                  <h1 class="mb-0 site-logo"><a href="index.html" class="h3 mb-0">Deaf Interpreter<span class="text-primary"></span> </a></h1>
                </div>
      
                <div class="col-6 d-inline-block d-xl-none ml-md-0 py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-black float-right"><span class="icon-menu h3"></span></a></div>
               
              </div>
            </div>
            
          </header>

          <div class="site-blocks-cover overlay" style="background-image: url(images/Sign02.jpg);" data-aos="fade" id="home-section">
            <div class="container">
              <div class="row align-items-center justify-content-center">
                   
                    <div>
                     <video></video>
                    </div>
                    <div class="col-md-6 mt-lg-5 text-center">
                        <div class="btn btn-warning mr-2 mb-2">START RECORDING</div>
                        <div class="btn btn-warning mr-2 mb-2">STOP RECORDING</div>
                    </div>        
                     
                    <div>
                    <p class="mb-1">Recorded Video</p>
                    <video id="vid2" controls></video>
                    </div>
                       
                      
              </div>
            </div>
          </div>
        
        <script>
            let constraintObj = { 
                // audio: false, 
                video: { 
                    facingMode: "user", 
                    width: 640,
                    height: 480
                    // width: { min: 640, ideal: 1280, max: 1920 },
                    // height: { min: 480, ideal: 720, max: 1080 } 
                } 
            }; 
            // width: 1280, height: 720  -- preference only
            // facingMode: {exact: "user"}
            // facingMode: "environment"
        
            //handle older browsers that might implement getUserMedia in some way
            if (navigator.mediaDevices === undefined) {
                navigator.mediaDevices = {};
                navigator.mediaDevices.getUserMedia = function(constraintObj) {
                    let getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                    if (!getUserMedia) {
                        return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
                    }
                    return new Promise(function(resolve, reject) {
                        getUserMedia.call(navigator, constraintObj, resolve, reject);
                    });
                }
            } else {
                navigator.mediaDevices.enumerateDevices().then(devices => {
                    devices.forEach(device=>{
                        console.log(device.kind.toUpperCase(), device.label);
                        //, device.deviceId
                    })
                })
                .catch(err=>{
                    console.log(err.name, err.message);
                })
            }
            
            navigator.mediaDevices.getUserMedia(constraintObj).then(function(mediaStreamObj) {
                //connect the media stream to the first video element
                let video = document.querySelector('video');
                if ("srcObject" in video) {
                    video.srcObject = mediaStreamObj;
                } else {
                    //old version
                    video.src = window.URL.createObjectURL(mediaStreamObj);
                }
            
                video.onloadedmetadata = function(ev) {
                    //show in the video element what is being captured by the webcam
                    video.play();
                };
            
                //add listeners for saving video/audio
                let start = document.getElementById('btnStart');
                let stop = document.getElementById('btnStop');
                let vidSave = document.getElementById('vid2');
                let mediaRecorder = new MediaRecorder(mediaStreamObj);
                let chunks = [];
            
                start.addEventListener('click', (ev)=>{
                    mediaRecorder.start();
                    console.log(mediaRecorder.state);
                })

                stop.addEventListener('click', (ev)=>{
                    mediaRecorder.stop();
                    console.log(mediaRecorder.state);
                });

                mediaRecorder.ondataavailable = function(ev) {
                    chunks.push(ev.data);
                }

                mediaRecorder.onstop = (ev)=>{
                    let blob = new Blob(chunks, { 'type' : 'video/mp4;' });
                    chunks = [];
                    let videoURL = window.URL.createObjectURL(blob);
                    vidSave.src = videoURL;
                }
            })

            .catch(function(err) { 
                console.log(err.name, err.message); 
            });
        </script>
        <script src="js/jquery-3.3.1.min.js"></script>
        <script src="js/jquery-migrate-3.0.1.min.js"></script>
        <script src="js/jquery-ui.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/owl.carousel.min.js"></script>
        <script src="js/jquery.stellar.min.js"></script>
        <script src="js/jquery.countdown.min.js"></script>
        <script src="js/bootstrap-datepicker.min.js"></script>
        <script src="js/jquery.easing.1.3.js"></script>
        <script src="js/aos.js"></script>
        <script src="js/jquery.fancybox.min.js"></script>
        <script src="js/jquery.sticky.js"></script>
      
        
        <script src="js/main.js"></script>
    </body>
</html>